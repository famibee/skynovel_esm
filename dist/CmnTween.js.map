{"version":3,"file":"CmnTween.js","sources":["../src/sn/CmnTween.ts"],"sourcesContent":["/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2019-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport {type IEvtMng, CmnLib, argChk_Boolean, argChk_Num} from './CmnLib';\nimport type {HArg} from './Grammar';\n\nimport {Tween, Easing, removeAll, update} from '@tweenjs/tween.js'\nimport {Application} from 'pixi.js';\n\ninterface ITwInf {\n\ttw\t\t: Tween<any> | undefined;\n\tonEnd?\t: ()=> void;\n}\n\nexport class CmnTween {\n\tstatic\t#hTwInf\t: {[tw_nm: string]: ITwInf}\t= {};\n\n\tstatic\t#evtMng\t: IEvtMng;\n\tstatic\t#appPixi: Application;\n\tstatic\tinit(evtMng: IEvtMng, appPixi: Application) {\n\t\tCmnTween.#hTwInf = {};\n\t\tCmnTween.#evtMng = evtMng;\n\t\tCmnTween.#appPixi = appPixi;\n\n\t\tCmnTween.#appPixi.ticker.add(CmnTween.#fncTicker);\t// TWEEN 更新\n\t}\n\tstatic\t#fncTicker = ()=> update();\n\tstatic\tdestroy() {\n\t\tCmnTween.stopAllTw();\n\t\tCmnTween.#appPixi.ticker.remove(CmnTween.#fncTicker);\n\t}\n\n\tstatic\tsetTwProp(tw: Tween<any>, hArg: HArg): Tween<any> {\n\t\tconst repeat = argChk_Num(hArg, 'repeat', 1);\n\t\treturn tw.delay(argChk_Num(hArg, 'delay', 0))\n\t\t.easing(CmnTween.ease(hArg.ease))\n\t\t.repeat(repeat > 0 ?repeat -1 :Infinity)\t// 一度リピート→計二回なので\n\t\t.yoyo(argChk_Boolean(hArg, 'yoyo', false));\n\t}\n\tstatic\treadonly #hEase: {[name: string]: (k: number)=> number}\t= {\n\t\t'Back.In'\t\t\t: k=> Easing.Back.In(k),\n\t\t'Back.InOut'\t\t: k=> Easing.Back.InOut(k),\n\t\t'Back.Out'\t\t\t: k=> Easing.Back.Out(k),\n\t\t'Bounce.In'\t\t\t: k=> Easing.Bounce.In(k),\n\t\t'Bounce.InOut'\t\t: k=> Easing.Bounce.InOut(k),\n\t\t'Bounce.Out'\t\t: k=> Easing.Bounce.Out(k),\n\t\t'Circular.In'\t\t: k=> Easing.Circular.In(k),\n\t\t'Circular.InOut'\t: k=> Easing.Circular.InOut(k),\n\t\t'Circular.Out'\t\t: k=> Easing.Circular.Out(k),\n\t\t'Cubic.In'\t\t\t: k=> Easing.Cubic.In(k),\n\t\t'Cubic.InOut'\t\t: k=> Easing.Cubic.InOut(k),\n\t\t'Cubic.Out'\t\t\t: k=> Easing.Cubic.Out(k),\n\t\t'Elastic.In'\t\t: k=> Easing.Elastic.In(k),\n\t\t'Elastic.InOut'\t\t: k=> Easing.Elastic.InOut(k),\n\t\t'Elastic.Out'\t\t: k=> Easing.Elastic.Out(k),\n\t\t'Exponential.In'\t: k=> Easing.Exponential.In(k),\n\t\t'Exponential.InOut'\t: k=> Easing.Exponential.InOut(k),\n\t\t'Exponential.Out'\t: k=> Easing.Exponential.Out(k),\n\t\t'Linear.None'\t\t: k=> Easing.Linear.None(k),\n\t\t'Quadratic.In'\t\t: k=> Easing.Quadratic.In(k),\n\t\t'Quadratic.InOut'\t: k=> Easing.Quadratic.InOut(k),\n\t\t'Quadratic.Out'\t\t: k=> Easing.Quadratic.Out(k),\n\t\t'Quartic.In'\t\t: k=> Easing.Quartic.In(k),\n\t\t'Quartic.InOut'\t\t: k=> Easing.Quartic.InOut(k),\n\t\t'Quartic.Out'\t\t: k=> Easing.Quartic.Out(k),\n\t\t'Quintic.In'\t\t: k=> Easing.Quintic.In(k),\n\t\t'Quintic.InOut'\t\t: k=> Easing.Quintic.InOut(k),\n\t\t'Quintic.Out'\t\t: k=> Easing.Quintic.Out(k),\n\t\t'Sinusoidal.In'\t\t: k=> Easing.Sinusoidal.In(k),\n\t\t'Sinusoidal.InOut'\t: k=> Easing.Sinusoidal.InOut(k),\n\t\t'Sinusoidal.Out'\t: k=> Easing.Sinusoidal.Out(k),\n\t};\n\tstatic\tease(nm: string | undefined): (k: number)=> number {\n\t\tif (! nm) return k=> Easing.Linear.None(k);\n\n\t\tconst es = CmnTween.#hEase[nm];\n\t\tif (! es) throw '異常なease指定です';\n\t\treturn es;\n\t}\n\n\tstatic readonly hMemberCnt\t= {\n\t\talpha\t\t: 0,\n\t\theight\t\t: 0,\n\t\trotation\t: 0,\t// rotationX〜Z、scaleZ、zは設定すると\n\t\tscale_x\t\t: 0,\t// 三次元方向の拡大縮小ルーチンが働き画像がぼやけるので\n\t\tscale_y\t\t: 0,\t// backlayで設定しない方針\n\t\tpivot_x\t\t: 0,\n\t\tpivot_y\t\t: 0,\n\t\twidth\t\t: 0,\n\t\tx\t\t\t: 0,\n\t\ty\t\t\t: 0,\n\t};\n\tstatic cnvTweenArg(hArg: HArg, lay: any): {} {\n\t\tconst hTo: any = {};\n\t\tfor (const nm of Object.keys(CmnTween.hMemberCnt)) {\n\t\t\tconst arg = (hArg as any)[nm];\n\t\t\tif (! arg) continue;\n\t\n\t\t\t// {x:500}\t\t\tX位置を500に\n\t\t\t// {x:'=500'}\t\t現在のX位置に+500加算した位置\n\t\t\t// {x:'=-500'}\t\t現在のX位置に-500加算した位置\n\t\t\t// {x:'250,500'}\t+250から＋500までの間でランダムな値をX位置に\n\t\t\t// {x:'=250,500'}\t+250から＋500までの間でランダムな値を現在のX位置に加算\n\t\t\tconst v = String(arg);\n\t\t\tconst hdeq = v.startsWith('=');\n\t\t\tconst vx = hdeq ?v.slice(1) :v;\n\t\t\tif (! vx) continue;\n\n\t\t\tconst [v0, v1] = vx.split(',');\n\t\t\tconst a0 = hTo[nm] = parseFloat(v0!);\n\n\t\t\tif (v1) hTo[nm] += Math.round(\n\t\t\t\tMath.random() * (parseFloat(v1) -a0 +1)\n\t\t\t);\n\t\t\tif (hdeq) hTo[nm] += parseFloat(lay[nm]);\t// 相対に\n\t\t}\n\t\treturn hTo;\n\t}\n\n\n\t// トゥイーン全停止\n\tstatic\tstopAllTw() {CmnTween.#hTwInf = {}; removeAll()}\n\n\n\tstatic\ttween(tw_nm: string, hArg: HArg, hNow: any, hTo: any, onUpdate: ()=> void, onComplete: ()=> void, onEnd: ()=> void, start = true): Tween<any> {\n\t\tconst time = this.#evtMng.isSkipping ?0 :argChk_Num(hArg, 'time', NaN);\n\t\tconst tw = new Tween(hNow)\n\t\t.to(hTo, time)\n\t\t.onUpdate(onUpdate);\n\t\tCmnTween.setTwProp(tw, hArg);\n\t\tCmnTween.#hTwInf[tw_nm] = {tw, onEnd};\n\n\t\tconst {path} = hArg;\n\t\tlet twLast = tw;\n\t\tif (path) {\n\t\t\tif (CmnLib.debugLog) console.group(`🍝 [${hArg[':タグ名']}] path=${path}= start(${hNow.x},${hNow.y},${hNow.alpha})`);\n\t\t\tfor (const {groups} of path.matchAll(CmnTween.#REG_TSY_PATH)) {\n\t\t\t\tconst {x, x2, y, y2, o, o2, json} = groups!;\n\t\t\t\tlet hArg2: any = {};\n\t\t\t\tif (json) try {hArg2 = JSON.parse(json)} catch (e) {\n\t\t\t\t\tconsole.error(`🍝 json=${json} `+ e);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (x ?? x2) hArg2.x = x ?? x2;\n\t\t\t\t\tif (y ?? y2) hArg2.y = y ?? y2;\n\t\t\t\t\tif (o ?? o2) hArg2.alpha = o ?? o2;\n\t\t\t\t}\n\n\t\t\t\tconst hTo2 = CmnTween.cnvTweenArg(hArg2, hNow);\n\t\t\t\tif (CmnLib.debugLog) console.info(`🍝 ${\n\t\t\t\t\tjson ?? `{x:${x} y:${y} o:${o}}`\n\t\t\t\t} => hTo:${JSON.stringify(hTo2)}`);\n\n\t\t\t\tconst twNew = new Tween(hNow)\n\t\t\t\t.to(hTo2, time);\n\t\t\t\tCmnTween.setTwProp(twNew, hArg);\n\t\t\t\ttwLast.chain(twNew);\n\n\t\t\t\ttwLast = twNew;\n\t\t\t}\n\t\t\tif (CmnLib.debugLog) console.groupEnd();\n\t\t}\n\t\ttwLast.onComplete(()=> {\n\t\t\tconst ti = CmnTween.#hTwInf[tw_nm];\n\t\t\tif (! ti) return;\n\t\t\tdelete CmnTween.#hTwInf[tw_nm];\n\n\t\t\tti.tw = undefined;\n\t\t\ttw.stop();\n\t\t\tCmnTween.#evtMng.breakEvent('tsy nm:'+ tw_nm);\t// waitEvent 使用者の通常 break 時義務\n\t\t\tti.onEnd?.();\n\n\t\t\tonComplete();\n\t\t});\n\n\t\tconst {chain} = hArg;\n\t\tif (chain) {\t// 指定レイヤのアニメ終了に、このトゥイーンを続ける\n\t\t\tconst twFrom = CmnTween.#hTwInf[chain];\n\t\t\tif (! twFrom?.tw) throw `${chain}は存在しない・または終了したトゥイーンです`;\n\t\t\tdelete twFrom.onEnd;\n\t\t\ttwFrom.tw.chain(tw);\n\t\t}\n\t\telse if (start) tw.start();\n\n\t\treturn tw;\n\t}\n\t// 11 match 301 step (0.1ms) PCRE2 https://regex101.com/r/reinpq/1\n\t\t// List ${x}${x2}/${y}${y2}/${o}${o2}=${json}\\n\n/*\n\\(\\s*\n(?:\t(?<x>[-=\\d\\.]+)\t|\t(['\"])\t(?<x2>.*?)\t\\2\t)?\n(?:\n\t\\s*,\\s*\n\t(?:\t(?<y>[-=\\d\\.]+)\t|\t(['\"])\t(?<y2>.*?)\t\\5\t)?\n\t(?:\n\t\t\\s*,\\s*\n\t\t(?:\t(?<o>[-=\\d\\.]+)\t|\t(['\"])\t(?<o2>.*?)\t\\8\t)\n\n\t)?\n)?\n|\n(?<json>\\{[^{}]*})\n*/\n\tstatic\treadonly\t#REG_TSY_PATH\t= /\\(\\s*(?:(?<x>[-=\\d\\.]+)|(['\"])(?<x2>.*?)\\2)?(?:\\s*,\\s*(?:(?<y>[-=\\d\\.]+)|(['\"])(?<y2>.*?)\\5)?(?:\\s*,\\s*(?:(?<o>[-=\\d\\.]+)|(['\"])(?<o2>.*?)\\8))?)?|(?<json>\\{[^{}]*})/g;\n\n\t// トランス終了待ち\n\tstatic\twt(hArg: HArg) {\n\t\tconst ti = CmnTween.#hTwInf[CmnTween.TW_INT_TRANS];\n\t\tif (! ti?.tw) return false;\n\n\t\treturn CmnTween.#evtMng.waitEvent('tsy nm:'+ CmnTween.TW_INT_TRANS, hArg, ()=> CmnTween.finish_trans());\n\t}\n\tstatic\treadonly\tTW_INT_TRANS = 'trans\\n';\t// 改行でスクリプトから絶対指定できない値に\n\n\t// レイヤのトランジションの停止\n\tstatic\tfinish_trans(): boolean {CmnTween.#hTwInf[CmnTween.TW_INT_TRANS]?.tw?.stop().end(); return false}\t// stop()とend()は別\n\n\n\t// トゥイーン終了待ち\n\tstatic\twait_tsy(hArg: HArg) {\n\t\tconst {layer='', id, name} = hArg;\n\t\tconst tw_nm = id ?`frm\\n${id}` :(name ?? layer);\n\t\tif (! tw_nm) throw 'トゥイーンが指定されていません';\n\t\tconst ti = CmnTween.#hTwInf[tw_nm];\n\t\tif (! ti?.tw) {\n\t\t\tif (argChk_Boolean(hArg, 'chk_exist_tw', false)) throw id\n\t\t\t?`フレームトゥイーン ${id} が見つかりません。`\n\t\t\t:`トゥイーン ${tw_nm} が見つかりません。(layer:${layer} name:${name})`;\n\n\t\t\treturn false;\n\t\t}\n\n\t\treturn CmnTween.#evtMng.waitEvent('tsy nm:'+ tw_nm, hArg, ()=> ti.tw?.end());\t// stop()とend()は別\n\t}\n\n\t// トゥイーン中断\n\tstatic\tstop_tsy(hArg: HArg) {\n\t\tconst {layer='', id, name} = hArg;\n\t\tconst tw_nm = id ?`frm\\n${id}` :(name ?? layer);\n\t\tif (! tw_nm) throw 'トゥイーンが指定されていません';\n\n\t\tCmnTween.#hTwInf[tw_nm]?.tw?.stop().end();\t// stop()とend()は別\n\n\t\treturn false;\n\t}\n\n\t// 一時停止\n\tstatic\tpause_tsy(hArg: HArg) {\n\t\tconst {layer='', id, name} = hArg;\n\t\tconst tw_nm = id ?`frm\\n${id}` :(name ?? layer);\n\t\tif (! tw_nm) throw 'トゥイーンが指定されていません';\n\n\t\tCmnTween.#hTwInf[tw_nm]?.tw?.pause();\n\n\t\treturn false;\n\t}\n\n\t// 一時停止再開\n\tstatic\tresume_tsy(hArg: HArg) {\n\t\tconst {layer='', id, name} = hArg;\n\t\tconst tw_nm = id ?`frm\\n${id}` :(name ?? layer);\n\t\tif (! tw_nm) throw 'トゥイーンが指定されていません';\n\n\t\tCmnTween.#hTwInf[tw_nm]?.tw?.resume();\n\n\t\treturn false;\n\t}\n\n}\n"],"names":["CmnTween","#hTwInf","#evtMng","#appPixi","evtMng","appPixi","#fncTicker","update","tw","hArg","repeat","argChk_Num","argChk_Boolean","#hEase","k","Easing","nm","es","lay","hTo","arg","v","hdeq","vx","v0","v1","a0","removeAll","tw_nm","hNow","onUpdate","onComplete","onEnd","start","time","Tween","path","twLast","CmnLib","groups","#REG_TSY_PATH","x","x2","y","y2","o","o2","json","hArg2","e","hTo2","twNew","ti","chain","twFrom","layer","id","name"],"mappings":"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"}